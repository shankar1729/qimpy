from typing import List, Tuple, Dict

L_MAX: int = 6  # Maximum l for harmonics
L_MAX_HLF: int = 3  # Maximum l for products
CooIndices = Tuple[List[int], List[int], List[float]]

# Recursion coefficients for computing real harmonics at l>1
# from products of those at l = 1 and l-1. The integers index
# a sparse matrix with (2l+1) rows and 3*(2l-1) columns.
YLM_RECUR: List[CooIndices] = [
    ([], [], [0.2820947917738781]),
    ([], [], [0.4886025119029199]),
    (
        [0, 1, 2, 2, 2, 3, 4, 4],
        [2, 1, 0, 4, 8, 5, 0, 8],
        [
            4.5764561643188433,
            4.5764561643188433,
            -1.3211090992019954,
            2.6422181984040067,
            -1.3211090992020016,
            4.5764561643188477,
            -2.2882280821594145,
            2.2882280821594216,
        ],
    ),
    (
        [0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 6, 6],
        [2, 12, 5, 2, 4, 12, 3, 7, 11, 0, 8, 14, 3, 11, 0, 14],
        [
            2.2106383479855136,
            2.2106383479855145,
            5.4149359583936683,
            -1.7123531012470736,
            3.4247062024941468,
            1.7123531012470696,
            -1.3981304525092222,
            2.4216329793552398,
            -1.3981304525092233,
            1.7123531012470756,
            5.9317651437161327,
            1.7123531012470752,
            -2.7074679791968346,
            2.7074679791968337,
            -2.2106383479855136,
            2.2106383479855065,
        ],
    ),
    (
        [0, 0, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 6, 7, 7, 8, 8],
        [
            2,
            18,
            5,
            15,
            2,
            8,
            18,
            5,
            7,
            15,
            6,
            10,
            14,
            3,
            11,
            17,
            0,
            6,
            14,
            20,
            3,
            17,
            0,
            20,
        ],
        [
            2.1708037636748019,
            2.1708037636748014,
            2.5066282746310025,
            2.5066282746309998,
            0.8204867005437914,
            6.3554626539815660,
            -0.8204867005437949,
            -1.8948328697018693,
            2.9959938268054818,
            1.8948328697018659,
            -1.4211246522764014,
            2.3206868393115694,
            -1.4211246522764021,
            2.8422493045528041,
            7.3386561482017383,
            2.8422493045527988,
            0.8204867005437924,
            -3.1777313269907852,
            3.1777313269907856,
            0.8204867005437926,
            -2.5066282746310011,
            2.5066282746309980,
            -2.1708037636748077,
            2.1708037636748072,
        ],
    ),
    (
        [
            0,
            0,
            1,
            1,
            2,
            2,
            2,
            3,
            3,
            3,
            4,
            4,
            4,
            5,
            5,
            5,
            6,
            6,
            6,
            7,
            7,
            7,
            7,
            8,
            8,
            8,
            9,
            10,
            10,
        ],
        [
            2,
            24,
            5,
            21,
            4,
            8,
            18,
            5,
            11,
            21,
            8,
            10,
            18,
            9,
            13,
            17,
            6,
            14,
            20,
            3,
            9,
            17,
            23,
            6,
            20,
            22,
            25,
            0,
            26,
        ],
        [
            2.1465482117262207,
            2.1465482117262149,
            2.3999138592002183,
            2.3999138592002209,
            1.1313302427360301,
            2.1165250798070239,
            2.1165250798070301,
            1.3855909126411585,
            7.3318579474390644,
            -1.3855909126411603,
            -1.9595214605580435,
            2.7711818252823188,
            1.9595214605580424,
            -1.4310321411507680,
            2.2626604854720656,
            -1.4310321411508553,
            3.9190429211160898,
            8.7632463783549266,
            3.9190429211160893,
            1.3855909126411572,
            -3.6659289737195300,
            3.6659289737195322,
            1.3855909126411579,
            -2.1165250798070194,
            2.1165250798070221,
            1.1313302427360317,
            6.7879814564162047,
            -2.1465482117262198,
            2.1465482117262180,
        ],
    ),
    (
        [
            0,
            0,
            1,
            2,
            2,
            2,
            2,
            3,
            3,
            3,
            4,
            4,
            4,
            5,
            5,
            5,
            6,
            6,
            6,
            7,
            7,
            7,
            8,
            8,
            8,
            8,
            9,
            9,
            9,
            10,
            10,
            10,
            11,
            12,
            12,
        ],
        [
            2,
            30,
            1,
            2,
            8,
            24,
            30,
            7,
            11,
            21,
            8,
            14,
            24,
            11,
            13,
            21,
            12,
            16,
            20,
            9,
            17,
            23,
            6,
            12,
            20,
            26,
            9,
            23,
            25,
            6,
            26,
            28,
            31,
            0,
            32,
        ],
        [
            2.1302244142778082,
            2.1302244142778157,
            7.3793138341056510,
            0.3933187489110493,
            2.6384623781708245,
            2.6384623781708245,
            -0.3933187489110491,
            1.2845736548025650,
            2.0976999941922561,
            2.0976999941922521,
            1.9268604822038509,
            8.3249887647815122,
            -1.9268604822038458,
            -1.9900529488108512,
            2.6325925992021340,
            1.9900529488108520,
            -1.4361970071219430,
            2.2249468361824887,
            -1.4361970071219425,
            4.9751323720271321,
            10.1959872940587761,
            4.9751323720271357,
            1.9268604822038473,
            -4.1624943823907543,
            4.1624943823907596,
            1.9268604822038453,
            -2.0976999941922534,
            2.0976999941922565,
            1.2845736548025646,
            -2.1107699025366586,
            2.1107699025366586,
            0.9950264744054266,
            7.3793138341056617,
            -2.1302244142778139,
            2.1302244142778148,
        ],
    ),
]

# Clebsch-Gordon coefficients for products of real harmonics.
# The integer indices correspond to l*(l+1)+m for each (l,m).
YLM_PROD: Dict[Tuple[int, int], Tuple[List[int], List[float]]] = {
    (0, 0): ([0], [0.2820947917738784]),
    (1, 0): ([1], [0.2820947917738785]),
    (1, 1): ([0, 6, 8], [0.2820947917738786, -0.1261566261010080, -0.2185096861184159]),
    (2, 0): ([2], [0.2820947917738795]),
    (2, 1): ([5], [0.2185096861184158]),
    (2, 2): ([0, 6], [0.2820947917738782, 0.2523132522020160]),
    (3, 0): ([3], [0.2820947917738795]),
    (3, 1): ([4], [0.2185096861184160]),
    (3, 2): ([7], [0.2185096861184159]),
    (3, 3): ([0, 6, 8], [0.2820947917738786, -0.1261566261010080, 0.2185096861184157]),
    (4, 0): ([4], [0.2820947917738784]),
    (4, 1): (
        [3, 13, 15],
        [0.2185096861184159, -0.0583991700819019, -0.2261790131595404],
    ),
    (4, 2): ([10], [0.1846743909223716]),
    (4, 3): ([1, 9, 11], [0.2185096861184163, 0.2261790131595399, -0.0583991700819021]),
    (4, 4): (
        [0, 6, 20, 24],
        [
            0.2820947917738775,
            -0.1802237515728689,
            0.0402992559676969,
            -0.2384136135044480,
        ],
    ),
    (5, 0): ([5], [0.2820947917738780]),
    (5, 1): (
        [2, 12, 14],
        [0.2185096861184160, -0.1430481681026689, -0.1846743909223716],
    ),
    (5, 2): ([1, 11], [0.2185096861184161, 0.2335966803276078]),
    (5, 3): ([10], [0.1846743909223717]),
    (5, 4): (
        [7, 21, 23],
        [0.1560783472274396, -0.0637187184340274, -0.1685838828361839],
    ),
    (5, 5): (
        [0, 6, 8, 20, 22],
        [
            0.2820947917738785,
            0.0901118757864351,
            -0.1560783472274397,
            -0.1611970238707871,
            -0.1802237515728685,
        ],
    ),
    (6, 0): ([6], [0.2820947917738779]),
    (6, 1): ([1, 11], [-0.1261566261010079, 0.2023006594034208]),
    (6, 2): ([2, 12], [0.2523132522020163, 0.2477666950834762]),
    (6, 3): ([3, 13], [-0.1261566261010080, 0.2023006594034206]),
    (6, 4): ([4, 18], [-0.1802237515728686, 0.1560783472274398]),
    (6, 5): ([5, 19], [0.0901118757864343, 0.2207281154418225]),
    (6, 6): ([0, 6, 20], [0.2820947917738784, 0.1802237515728686, 0.2417955358061814]),
    (7, 0): ([7], [0.2820947917738779]),
    (7, 1): ([10], [0.1846743909223717]),
    (7, 2): ([3, 13], [0.2185096861184161, 0.2335966803276074]),
    (7, 3): (
        [2, 12, 14],
        [0.2185096861184160, -0.1430481681026691, 0.1846743909223716],
    ),
    (7, 4): (
        [5, 17, 19],
        [0.1560783472274397, 0.1685838828361840, -0.0637187184340277],
    ),
    (7, 5): ([4, 18], [0.1560783472274399, 0.1802237515728685]),
    (7, 6): ([7, 21], [0.0901118757864343, 0.2207281154418226]),
    (7, 7): (
        [0, 6, 8, 20, 22],
        [
            0.2820947917738781,
            0.0901118757864337,
            0.1560783472274399,
            -0.1611970238707879,
            0.1802237515728685,
        ],
    ),
    (8, 0): ([8], [0.2820947917738773]),
    (8, 1): ([1, 9, 11], [-0.2185096861184158, 0.2261790131595402, 0.0583991700819017]),
    (8, 2): ([14], [0.1846743909223716]),
    (8, 3): (
        [3, 13, 15],
        [0.2185096861184160, -0.0583991700819019, 0.2261790131595404],
    ),
    (8, 4): ([16], [0.2384136135044478]),
    (8, 5): (
        [5, 17, 19],
        [-0.1560783472274401, 0.1685838828361841, 0.0637187184340275],
    ),
    (8, 6): ([8, 22], [-0.1802237515728683, 0.1560783472274399]),
    (8, 7): (
        [7, 21, 23],
        [0.1560783472274400, -0.0637187184340278, 0.1685838828361839],
    ),
    (8, 8): (
        [0, 6, 20, 24],
        [
            0.2820947917738779,
            -0.1802237515728681,
            0.0402992559676970,
            0.2384136135044476,
        ],
    ),
    (9, 0): ([9], [0.2820947917738776]),
    (9, 1): (
        [8, 22, 24],
        [0.2261790131595403, -0.0435281713775682, -0.2303294329808905],
    ),
    (9, 2): ([17], [0.1628675039676399]),
    (9, 3): (
        [4, 16, 18],
        [0.2261790131595403, 0.2303294329808903, -0.0435281713775681],
    ),
    (9, 4): (
        [3, 13, 31, 35],
        [
            0.2261790131595405,
            -0.0940315972579595,
            0.0169433177293593,
            -0.2455320005465372,
        ],
    ),
    (9, 5): (
        [14, 32, 34],
        [0.1486770096793978, -0.0448278050962366, -0.1552880720369529],
    ),
    (9, 6): ([9, 27], [-0.2102610435016800, 0.1267921798770303]),
    (9, 7): (
        [10, 26, 28],
        [0.1486770096793975, 0.1552880720369530, -0.0448278050962364],
    ),
    (9, 8): (
        [1, 11, 25, 29],
        [
            0.2261790131595402,
            -0.0940315972579592,
            0.2455320005465368,
            0.0169433177293593,
        ],
    ),
    (9, 9): (
        [0, 6, 20, 42, 48],
        [
            0.2820947917738784,
            -0.2102610435016803,
            0.0769349432110577,
            -0.0118543966932642,
            -0.2548005986729748,
        ],
    ),
    (10, 0): ([10], [0.2820947917738780]),
    (10, 1): (
        [7, 21, 23],
        [0.1846743909223714, -0.0753930043865133, -0.1994711402007164],
    ),
    (10, 2): ([4, 18], [0.1846743909223720, 0.2132436186229229]),
    (10, 3): (
        [5, 17, 19],
        [0.1846743909223717, 0.1994711402007163, -0.0753930043865134],
    ),
    (10, 4): (
        [2, 12, 30, 34],
        [
            0.1846743909223713,
            -0.1880631945159190,
            0.0535794751446880,
            -0.1901882698155453,
        ],
    ),
    (10, 5): (
        [3, 13, 15, 31, 33],
        [
            0.1846743909223714,
            0.1151647164904452,
            -0.1486770096793977,
            -0.0830049659735644,
            -0.1793112203849456,
        ],
    ),
    (10, 6): ([28], [0.1901882698155452]),
    (10, 7): (
        [1, 9, 11, 27, 29],
        [
            0.1846743909223720,
            0.1486770096793975,
            0.1151647164904451,
            0.1793112203849457,
            -0.0830049659735641,
        ],
    ),
    (10, 8): ([26], [0.1901882698155456]),
    (10, 9): (
        [7, 21, 43, 47],
        [
            0.1486770096793975,
            -0.0993225845992800,
            0.0221775454765502,
            -0.1801712311720526,
        ],
    ),
    (10, 10): (
        [0, 20, 24, 42, 46],
        [
            0.2820947917738786,
            -0.1795148674924677,
            -0.1517177540482846,
            0.0711263801595844,
            -0.1881827135584986,
        ],
    ),
    (11, 0): ([11], [0.2820947917738779]),
    (11, 1): (
        [6, 8, 20, 22],
        [
            0.2023006594034205,
            0.0583991700819019,
            -0.1507860087730268,
            -0.1685838828361839,
        ],
    ),
    (11, 2): ([5, 19], [0.2335966803276074, 0.2384136135044481]),
    (11, 3): ([4, 18], [-0.0583991700819018, 0.1685838828361839]),
    (11, 4): (
        [3, 13, 15, 31, 33],
        [
            -0.0583991700819016,
            0.1456731240789439,
            0.0940315972579592,
            -0.0656211873953098,
            -0.1417579666102105,
        ],
    ),
    (11, 5): (
        [2, 12, 14, 30, 32],
        [
            0.2335966803276077,
            0.0594708038717591,
            -0.1151647164904453,
            -0.1694331772935933,
            -0.1736173425847554,
        ],
    ),
    (11, 6): (
        [1, 11, 29],
        [0.2023006594034206, 0.1261566261010081, 0.2273184612433488],
    ),
    (11, 7): ([10, 28], [0.1151647164904451, 0.1736173425847554]),
    (11, 8): (
        [1, 9, 11, 27, 29],
        [
            0.0583991700819017,
            -0.0940315972579594,
            -0.1456731240789438,
            0.1417579666102104,
            0.0656211873953094,
        ],
    ),
    (11, 9): (
        [8, 22, 24, 44, 46],
        [
            -0.0940315972579595,
            0.1332552305189783,
            0.1175200669506000,
            -0.0443550909531001,
            -0.1214714192760308,
        ],
    ),
    (11, 10): (
        [7, 21, 23, 43, 45],
        [
            0.1151647164904450,
            0.1025799242814103,
            -0.0678502422891120,
            -0.0858932642904358,
            -0.1629710104947502,
        ],
    ),
    (11, 11): (
        [0, 6, 8, 20, 22, 42, 44],
        [
            0.2820947917738783,
            0.1261566261010075,
            -0.1456731240789440,
            0.0256449810703529,
            -0.1146878419100072,
            -0.1778159503989606,
            -0.1717865285808717,
        ],
    ),
    (12, 0): ([12], [0.2820947917738779]),
    (12, 1): ([5, 19], [-0.1430481681026688, 0.1946639002730062]),
    (12, 2): ([6, 20], [0.2477666950834757, 0.2462325212298291]),
    (12, 3): ([7, 21], [-0.1430481681026691, 0.1946639002730061]),
    (12, 4): ([10, 28], [-0.1880631945159186, 0.1417579666102104]),
    (12, 5): (
        [1, 11, 29],
        [-0.1430481681026685, 0.0594708038717592, 0.2143179005787511],
    ),
    (12, 6): (
        [2, 12, 30],
        [0.2477666950834758, 0.1682088348013438, 0.2396146972445650],
    ),
    (12, 7): (
        [3, 13, 31],
        [-0.1430481681026686, 0.0594708038717590, 0.2143179005787512],
    ),
    (12, 8): ([14, 32], [-0.1880631945159188, 0.1417579666102105]),
    (12, 9): ([17, 39], [-0.2035507268673355, 0.1086473403298333]),
    (12, 10): (
        [4, 18, 40],
        [-0.1880631945159188, -0.0444184101729927, 0.1774203638124000],
    ),
    (12, 11): (
        [5, 19, 41],
        [0.0594708038717590, 0.0993225845992799, 0.2217754547654998],
    ),
    (12, 12): (
        [0, 6, 20, 42],
        [
            0.2820947917738785,
            0.1682088348013445,
            0.1538698864221152,
            0.2370879338652808,
        ],
    ),
    (13, 0): ([13], [0.2820947917738783]),
    (13, 1): ([4, 18], [-0.0583991700819018, 0.1685838828361839]),
    (13, 2): ([7, 21], [0.2335966803276075, 0.2384136135044481]),
    (13, 3): (
        [6, 8, 20, 22],
        [
            0.2023006594034206,
            -0.0583991700819017,
            -0.1507860087730269,
            0.1685838828361839,
        ],
    ),
    (13, 4): (
        [1, 9, 11, 27, 29],
        [
            -0.0583991700819018,
            -0.0940315972579594,
            0.1456731240789438,
            0.1417579666102105,
            -0.0656211873953095,
        ],
    ),
    (13, 5): ([10, 28], [0.1151647164904451, 0.1736173425847554]),
    (13, 6): (
        [3, 13, 31],
        [0.2023006594034204, 0.1261566261010078, 0.2273184612433489],
    ),
    (13, 7): (
        [2, 12, 14, 30, 32],
        [
            0.2335966803276078,
            0.0594708038717592,
            0.1151647164904456,
            -0.1694331772935933,
            0.1736173425847554,
        ],
    ),
    (13, 8): (
        [3, 13, 15, 31, 33],
        [
            -0.0583991700819017,
            0.1456731240789439,
            -0.0940315972579594,
            -0.0656211873953093,
            0.1417579666102103,
        ],
    ),
    (13, 9): (
        [4, 16, 18, 38, 40],
        [
            -0.0940315972579593,
            -0.1175200669506000,
            0.1332552305189780,
            0.1214714192760304,
            -0.0443550909530999,
        ],
    ),
    (13, 10): (
        [5, 17, 19, 39, 41],
        [
            0.1151647164904454,
            0.0678502422891121,
            0.1025799242814101,
            0.1629710104947501,
            -0.0858932642904359,
        ],
    ),
    (13, 11): (
        [4, 18, 40],
        [0.1456731240789441, 0.1146878419100072, 0.1717865285808717],
    ),
    (13, 12): (
        [7, 21, 43],
        [0.0594708038717591, 0.0993225845992800, 0.2217754547655001],
    ),
    (13, 13): (
        [0, 6, 8, 20, 22, 42, 44],
        [
            0.2820947917738780,
            0.1261566261010068,
            0.1456731240789441,
            0.0256449810703525,
            0.1146878419100073,
            -0.1778159503989610,
            0.1717865285808716,
        ],
    ),
    (14, 0): ([14], [0.2820947917738783]),
    (14, 1): (
        [5, 17, 19],
        [-0.1846743909223720, 0.1994711402007165, 0.0753930043865134],
    ),
    (14, 2): ([8, 22], [0.1846743909223725, 0.2132436186229230]),
    (14, 3): (
        [7, 21, 23],
        [0.1846743909223719, -0.0753930043865136, 0.1994711402007163],
    ),
    (14, 4): ([26], [0.1901882698155456]),
    (14, 5): (
        [1, 9, 11, 27, 29],
        [
            -0.1846743909223718,
            0.1486770096793975,
            -0.1151647164904452,
            0.1793112203849457,
            0.0830049659735642,
        ],
    ),
    (14, 6): ([32], [0.1901882698155456]),
    (14, 7): (
        [3, 13, 15, 31, 33],
        [
            0.1846743909223716,
            0.1151647164904455,
            0.1486770096793973,
            -0.0830049659735640,
            0.1793112203849456,
        ],
    ),
    (14, 8): (
        [2, 12, 30, 34],
        [
            0.1846743909223719,
            -0.1880631945159187,
            0.0535794751446877,
            0.1901882698155457,
        ],
    ),
    (14, 9): (
        [5, 19, 37, 41],
        [
            0.1486770096793977,
            -0.0993225845992800,
            0.1801712311720527,
            0.0221775454765501,
        ],
    ),
    (14, 10): ([16, 38], [0.1517177540482859, 0.1881827135584984]),
    (14, 11): (
        [5, 17, 19, 39, 41],
        [
            -0.1151647164904454,
            0.0678502422891122,
            -0.1025799242814099,
            0.1629710104947501,
            0.0858932642904358,
        ],
    ),
    (14, 12): (
        [8, 22, 44],
        [-0.1880631945159189, -0.0444184101729927, 0.1774203638124001],
    ),
    (14, 13): (
        [7, 21, 23, 43, 45],
        [
            0.1151647164904449,
            0.1025799242814103,
            0.0678502422891117,
            -0.0858932642904360,
            0.1629710104947500,
        ],
    ),
    (14, 14): (
        [0, 20, 24, 42, 46],
        [
            0.2820947917738785,
            -0.1795148674924676,
            0.1517177540482855,
            0.0711263801595843,
            0.1881827135584984,
        ],
    ),
    (15, 0): ([15], [0.2820947917738780]),
    (15, 1): (
        [4, 16, 18],
        [-0.2261790131595405, 0.2303294329808905, 0.0435281713775681],
    ),
    (15, 2): ([23], [0.1628675039676400]),
    (15, 3): (
        [8, 22, 24],
        [0.2261790131595401, -0.0435281713775682, 0.2303294329808904],
    ),
    (15, 4): (
        [1, 11, 25, 29],
        [
            -0.2261790131595402,
            0.0940315972579597,
            0.2455320005465368,
            -0.0169433177293594,
        ],
    ),
    (15, 5): (
        [10, 26, 28],
        [-0.1486770096793977, 0.1552880720369528, 0.0448278050962364],
    ),
    (15, 6): ([15, 33], [-0.2102610435016798, 0.1267921798770303]),
    (15, 7): (
        [14, 32, 34],
        [0.1486770096793975, -0.0448278050962361, 0.1552880720369527],
    ),
    (15, 8): (
        [3, 13, 31, 35],
        [
            0.2261790131595403,
            -0.0940315972579595,
            0.0169433177293594,
            0.2455320005465372,
        ],
    ),
    (15, 9): ([36], [0.2548005986729751]),
    (15, 10): (
        [5, 19, 37, 41],
        [
            -0.1486770096793978,
            0.0993225845992799,
            0.1801712311720525,
            -0.0221775454765501,
        ],
    ),
    (15, 11): (
        [4, 16, 18, 38, 40],
        [
            0.0940315972579593,
            -0.1175200669505997,
            -0.1332552305189780,
            0.1214714192760313,
            0.0443550909531000,
        ],
    ),
    (15, 12): ([23, 45], [-0.2035507268673355, 0.1086473403298335]),
    (15, 13): (
        [8, 22, 24, 44, 46],
        [
            -0.0940315972579594,
            0.1332552305189782,
            -0.1175200669506001,
            -0.0443550909530999,
            0.1214714192760308,
        ],
    ),
    (15, 14): (
        [7, 21, 43, 47],
        [
            0.1486770096793974,
            -0.0993225845992799,
            0.0221775454765500,
            0.1801712311720526,
        ],
    ),
    (15, 15): (
        [0, 6, 20, 42, 48],
        [
            0.2820947917738783,
            -0.2102610435016805,
            0.0769349432110578,
            -0.0118543966932641,
            0.2548005986729752,
        ],
    ),
}
